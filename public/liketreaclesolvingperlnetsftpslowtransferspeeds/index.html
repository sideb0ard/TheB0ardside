<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">

    <base href="http://theb0ardside.com">
    <title> TheB0ardside.com </title>
    <link rel="canonical" href="http://theb0ardside.com/liketreaclesolvingperlnetsftpslowtransferspeeds/">
    <link href="/static/css/b0ardstrap.min.css" rel="stylesheet"/>
    <link href="/static/css/b0ardstyle.css" rel="stylesheet"/>

    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://theb0ardside.com/index.xml" />

</head>
<body lang="en">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  
  <div class="navbar-blah">
  <div class="navbar-header">
    <a class="navbar-brand" href="/">The B0ardside_</a>
  </div>

  <div>
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">hello<b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><img src="/static/img/thor.jpg"></li>
            <li><a href="/categories/blog/">All Articles</a></li>
            <li><a target="new" href="mailto:thorsten@theb0ardside.com?subject=hullo">Email</a></li>
            <li><a target="new" href="http://github.com/sideb0ard">Code</a></li>
            <li><a target="new" href="http://drawingb0ard.blogspot.com/">Drawings</a></li>
            <li><a target="new" href="http://bff.fm/shows/highpoint-lowlife">Radio Show</a></li>
            <li><a target="new" href="https://sideb0ard.bandcamp.com/">Music</a></li>
            <li><a target="new" href="http://twitter.com/sideb0ard">Twitter</a></li>
            <li><a target="new" href="http://theb0ardside.com/index.xml">Rss Feed</a></li>
        </ul>
      </li>
    </ul>
  </div>
</div>
</nav>

  <div class="container">
  <div id="page">



<section id="main">
  <h1 id="title">Like Treacle, Solving Perl Net::SFTP Slow Transfer Speeds</h1>
  <div>
        <article id="content">
           <p>I've been trying to track down problems with really slow network transfer speeds between my servers and several DSPs. I knew it wasn't local I/O, as we could hit around 60Mb/s to some services, whereas the problematic ones were a sluggish 0.30Mb/s; I knew we weren't hitting our bandwidth limit, as cacti showed us daily peaks of only around 500Mb/s of our 600Mb/s line. </p><p>I was working with the network engineer on the other side, running tcpdump captures while uploading a file and analysing that in Wireshark's IO Graphs - stream looked absolutely fine, no lost packets, big non-changing tcp receive windows. We were pretty much stumped, and the other engineer recommend i look into <a href="http://www.psc.edu/networking/projects/hpn-ssh/">HPN-SSH</a>, which does indeed sound very good, but first i started playing around with trying different ciphers and compression.</p><p>Our uploads are all run via a perl framework, which utilises Net::SFTP in order to do the transfers.<a href="https://github.com/sideb0ard/speedTester" target="_blank"> My test program was also written in perl</a> and using the same library. In order to try different cyphers i started testing uploads with the interactive command line SFTP. Boom! 6Mb/s upload speed. Biiiig difference from the Net::SFTP client. I started playing with blowfish cipher and trying to enable compression with Net::SFTP - it wasn't really working, it can only do Zlib compression, which my SSHD server wouldn't play with until i specifically enabled compression in the sshd_config file.</p><p>After much more digging around, i came across reference to <a href="http://search.cpan.org/~salva/Net-SFTP-Foreign-1.69/lib/Net/SFTP/Foreign.pm">Net::SFTP::Foreign</a>, which uses the installed ssh binary on your system for transport rather than relying on the pure perl Net::SSH.</p><p>Syntax is very similar, so it was a minor rewrite to switch modules, yet such a massive payback, from 0.30Mb/s up to 6Mb/s. </p><p>(It turns out the DSPs i mentioned earlier who could achieve 60Mb/s were actually FTP transfers, not SFTP)</p>

        </article>
  </div>
</section>

<aside id="meta">
    <div>
    <section>
      <h4 id="date"> Sun Feb 19, 2012 </h4>
    </section>
    <ul id="tags">
      
        <li> <a href="http://theb0ardside.com/tags/big-data">big data</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/cloud">cloud</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/distribution">distribution</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/internet">internet</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/networking">networking</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/perl">perl</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/programming">programming</a> </li>
      
        <li> <a href="http://theb0ardside.com/tags/unix">unix</a> </li>
      
    </ul>
    </div>
    <div>
        
          <a class="previous" href="http://theb0ardside.com/theinformation/">Previous:: The Information</a>
        
    </div>
    <div>
        
          <a class="next" href="http://theb0ardside.com/buildingadebpackagefromaperlscript/">Next:: building a DEB package from a perl script</a>
        
    </div>
</aside>

      <script src="/static/js/jquery.js"></script>
      <script src="/static/js/bootstrap.min.js"></script>
      <script src="/static/js/mousetrap.min.js"></script>
      <script src="/static/js/b0ardside.js"></script>
      </div>
      </div>
      <div id="footer"></div>
  </body>

</html>

