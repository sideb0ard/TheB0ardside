<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">

    <base href="http://theb0ardside.com">
    <title> TheB0ardside.com </title>
    <link rel="canonical" href="http://theb0ardside.com/tags/simulator.html">
    <link href="http://theb0ardside.com/static/css/b0ardstrap.min.css" rel="stylesheet"/>
    <link href="http://theb0ardside.com/static/css/b0ardstyle.css" rel="stylesheet"/>

    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://theb0ardside.com/index.xml" />

</head>
<body lang="en">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  
  <div class="navbar-blah">
  <div class="navbar-header">
    <a class="navbar-brand" href="http://theb0ardside.com/">The B0ardside_</a>
  </div>

  <div>
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">hello<b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><img src="http://theb0ardside.com/static/img/thor.jpg"></li>
            <li><a target="new" href="http://theb0ardside.com/categories/blog/">All Articles</a></li>
            <li><a target="new" href="mailto:thorsten@theb0ardside.com?subject=hullo">Email</a></li>
            <li><a target="new" href="http://github.com/sideb0ard">Code</a></li>
            <li><a target="new" href="http://drawingb0ard.blogspot.com/">Drawings</a></li>
            <li><a target="new" href="http://bff.fm/shows/the-nodecast">Radio Show</a></li>
            <li><a target="new" href="https://b0ardside.bandcamp.com/">Music</a></li>
            <li><a target="new" href="http://twitter.com/sideb0ard">Twitter</a></li>
            <li><a target="new" href="http://theb0ardside.com/index.xml">Rss Feed</a></li>
        </ul>
      </li>
    </ul>
  </div>
</div>
</nav>

  <div class="container">
  <div id="page">


<section id="main">
  <div>
   <h1 id="title">Simulator</h1>
    
        <article class="post">
    <header>
      <h2><a href='http://theb0ardside.com/vagrantandchefsetup/'> Vagrant and Chef setup</a> </h2>
      <div class="post-meta">Fri, Aug 5, 2011</div>
    </header>
    <p>I've been reading through ThoughtWorks' latest &#8216;<a href="http://www.thoughtworks.com/radar" title="radar" target="_blank">technology radar</a>&#8216; which led me to look up <a href="http://vagrantup.com/" title="Vagrant" target="_blank">Vagrant</a>, one of the tools they list as worth exploring.</p><p>Vagrant is a framework for building and deploying Virtual Machine environments, using Oracle VirtualBox for the actual VMs and utilizing Chef for configuration management.  </p><p>Watching through this intro video:</p><p>http://vimeo.com/9976342</p><p>i was quite intrigued as it is very similar to what i was looking to achieve earlier when i was <a href="http://www.theb0ardside.com/?p=22" title="Xen and Puppet" target="_blank">experimenting with installing Xen and configuring with Puppet.</a></p><p>So here's what I experienced during the setup of Vagrant on my Macbook - I decided to start with a simple Chef install to familiarise myself with Chef itself and it's own requirements CouchDB, RabbitMQ and Solr, mostly by following <a href="http://wiki.opscode.com/display/chef/Manual+Chef+Server+Configuration" title="Chef Manual Install OS X" target="_blank">these instructions</a> - </p><p><strong>-CHEF INSTALL-</strong></p><p><strong>sudo gem install chef<br />sudo gem install ohai<br /></strong></p><p>Chef uses couchDB as it's datastore, so we need to install it using the instructions <a href="http://wiki.apache.org/couchdb/Installing_on_OSX" title="CouchDB install OS X" target="_blank">here</a> </p><p><strong>brew install couchdb</strong></p><p>The instructions I list above also contains steps to install a couchDB user and set it up as a daemon. They didn't work for me, and after 30mins of troubleshooting, i gave up and went with the simpler option of running it under my own user - in production this will be running on a Linux server rather than my Macbook, so it seemed fair enough -</p><p><strong>cp /usr/local/Cellar/couchdb/1.1.0/Library/LaunchDaemons/org.apache.couchdb.plist ~/Library/LaunchAgents/</p><p>launchctl load -w ~/Library/LaunchAgents/org.apache.couchdb.plist</strong></p><p>Check its running okay by going to<br /><a href="http://127.0.0.1:5984/" title="Localhost" target="_blank">http://127.0.0.1:5984/</a></p><p>which should provide something akin to :<br /><strong>{&#8220;couchdb&#8221;:&#8221;Welcome&#8221;,&#8221;version&#8221;:&#8221;1.1.0&#8243;}</strong></p><p><strong>- INSTALL RABBITMQ -</strong></p><p><strong>brew install rabbitmq<br />/usr/local/sbin/rabbitmq-server -detached</p><p>sudo rabbitmqctl add_vhost /chef<br />sudo rabbitmqctl add_user chef testing<br />sudo rabbitmqctl set_permissions -p /chef chef &#8220;.*&#8221; &#8220;.*&#8221; &#8220;.*&#8221;<br /></strong></p><p>Ok, Gettin' back to my mission, break out the whipped cream and the cherries, then I go through all the fly positions - oh, wrong mission! </p><p>Ok..</p><p><strong>brew install gecode<br />brew install solr</p><p>sudo gem install chef-server chef-server-api chef-server chef-solr<br />sudo gem install chef-server-webui<br />sudo chef-solr-installer<br /></strong></p><p>Setup a conf file -<br /><strong>sudo mkdir /etc/chef<br />sudo vi /etc/chef/server.rb</strong> - paste in the example from:</p><p><a href="http://wiki.opscode.com/display/chef/Manual+Chef+Server+Configuration" title="chef conf" target="_blank">http://wiki.opscode.com/display/chef/Manual+Chef+Server+Configuration</a> - making the appropriate changes for your FQDN</p><p>At this point, the above instructions ask you to start the indexer however the instructions haven't been updated to reflect changes to Chef version 0.10.2 in which chef-solr-indexer has been replaced with chef-expander</p><p>So, instead of running:<br /><strong>sudo chef-solr-indexer </strong></p><p>you instead need to run:<br /><strong>sudo chef-expander -n1 -d<br /></strong></p><p>Next i tried<br /><strong>sudo chef-solr</strong></p><p>which ran into<br /><em>&#8220;`configure_chef': uninitialized constant Chef::Application::SocketError (NameError)&#8221;</em></p><p>i had to create an <strong>/etc/chef/solr.rb</strong> file and simply add this to the file:</p><p><strong>require &#8216;socket'</strong> </p><p>startup now worked -<br />if you want to daemonize it, use:</p><p><strong>sudo chef-solr -d</strong></p><p>Next start Chef Server with:<br /><strong>sudo chef-server -N -e production -d</strong></p><p>and finally:<br /><strong>sudo chef-server-webui -p 4040 -e production</strong></p><p>Now you should be up and running - you need to configure the command client &#8216;Knife' follwing the instructions <a href="http://wiki.opscode.com/display/chef/Manual+Chef+Server+Configuration" title="Knife setup" target="_blank">here</a> - under the section &#8216;<strong>Configure the Command Line Client</strong>&#8216;</p><p><strong>mkdir -p ~/.chef<br />sudo cp /etc/chef/validation.pem /etc/chef/webui.pem ~/.chef<br />sudo chown -R $USER ~/.chef</p><p>knife configure -i</strong></p><p>(follow the instructions at the link - you only need to change the location of the two pem files you copied above)</p><p>Ok, so hopefully you're at the same place as me with this all working at least as far as being able to log into CouchDB, and verifying that Chef/Knife are both working.</p><p><strong>- VAGRANT SETUP -</strong></p><p>Now, onward with the original task of Vagrant setup&#8230;<br />Have a read over the <a href="http://vagrantup.com/docs/getting-started/index.html " title="Vagrant Getting Started" target="_blank">getting started guide:</a></p><p>Install VirtualBox - download from <a href="http://www.virtualbox.org/wiki/Downloads" title="VirtualBox" target="_blank">http://www.virtualbox.org/wiki/Downloads</a></p><p>Run the installer, which should all work quite easily. Next..</p><p><strong>gem install vagrant</p><p>mkdir vagrant_guide<br />cd vagrant_guide/<br />vagrant init</strong></p><p>this creates the base Vagrantfile, which the documentation compares to a Makefile, basically a reference file for the project to work with.</p><p>Setup our first VM -<br /><strong>vagrant box add lucid32 http://files.vagrantup.com/lucid32.box</strong></p><p>This is downloaded and saved in ~/.vagrant.d/boxes/ </p><p>edit the Vagrantfile which was created and change the &#8220;box&#8221; entry to be &#8220;lucid32&#8243;, the name of the file we just saved. </p><p>Bring it online with:<br /><strong>vagrant up</strong></p><p>then ssh into with<br /><strong>vargrant ssh</strong></p><p>Ace, that worked quite easily. After a little digging around, I  logged out and tore the machine down again with<br /><strong>vagrant destroy</strong></p><p><strong>- TYING IT ALL TOGETHER -</strong><br />Now we need to connect our Vagrant install with our Chef server</p><p>First, clone the Chef repository with:<br /><strong>git clone git://github.com/opscode/chef-repo.git </strong></p><p>add this dir to your <strong>~/.chef/knife.rb</strong> file<br />i.e<br /><strong>cookbook_path           ["/Users/thorstensideboard/chef-repo/cookbooks"]</strong></p><p>Download the Vagrant cookbook they use in their examples -</p><p><strong>wget http://files.vagrantup.com/getting_started/cookbooks.tar.gz<br />tar xzvf cookbooks.tar.gz<br />mv cookbooks/* chef-repo/cookbooks/<br /></strong></p><p>Add it to our Chef server using Knife:<br /><strong>knife cookbook upload -a</strong><br />(knife uses the cookbook_path we setup above)</p><p>If you browse to your localhost at<br /><strong>http://sbd-ioda.local:4040/cookbooks/</strong><br />you should see the three new cookbooks which have been added.</p><p>Now to edit Vagrantfile and add your Chef details:<br /><code><br />Vagrant::Config.run do |config|</p><p>    config.vm.box = "lucid32"</p><p>    config.vm.provision :chef_client do |chef|</p><p>    chef.chef_server_url = "http://SBD-IODA.local:4000"<br />    chef.validation_key_path = "/Users/thorsten/.chef/validation.pem"<br />    chef.add_recipe("vagrant_main")<br />    chef.add_recipe("apt")<br />    chef.add_recipe("apache2")</p><p>    end<br />end<br /></code></p><p>I tried to load this up with<br /><strong>vagrant up</strong><br />however received:</p><blockquote><p>&#8220;[default] [Fri, 05 Aug 2011 09:27:07 -0700] INFO: *** Chef 0.10.2 ***<br />: stdout<br />[default] [Fri, 05 Aug 2011 09:27:07 -0700] INFO: Client key /etc/chef/client.pem is not present - registering<br />: stdout<br />[default] [Fri, 05 Aug 2011 09:27:28 -0700] FATAL: Stacktrace dumped to /srv/chef/file_store/chef-stacktrace.out<br />: stdout<br />[default] [Fri, 05 Aug 2011 09:27:28 -0700] FATAL: SocketError: Error connecting to http://SBD-IODA.local:4000/clients - getaddrinfo: Name or service not known&#8221;</p></blockquote><p>I figured this was a networking issue, and yeah, within the VM it has no idea of my Macbook's local hostname, which i fixed by editing its /etc/hosts file and manually adding it.</p><p>Upon issuing a<br /><strong>vagrant reload</strong>, boom! you can see the Vagrant host following the recipes and loading up a bunch of things including apache2</p><p>However at this point, you can still only access it's webserver from within the VM, so in order to access it from our own desktop browser, we can add the following line to the Vagrantfile:<br /><strong>config.vm.forward_port(&#8220;web&#8221;, 80, 8080)</strong></p><p>After another reload, you should now be able to connect to localhost:8080 and access your new VM's apache host.</p><p>In order to use this setup in any sort of dev environment will still need a good deal more work, but for the moment, this should be enough to get you up and running and able to explore both Vagrant and Chef. </p>

</article>

    
        <article class="post">
    <header>
      <h2><a href='http://theb0ardside.com/recordstorebot/'> Record Store Bot</a> </h2>
      <div class="post-meta">Tue, May 24, 2011</div>
    </header>
    <p><img class="aligncenter" title="specz" src="http://farm6.static.flickr.com/5244/5309938590_21a2f8d308_z.jpg" alt="" width="452" height="640" /></p><p>First draft of my Record Store Bot is live over on <a title="Record Store Bot" href="https://github.com/sideb0ard/RecordStoreBot" target="_blank">Github</a> - basically tying a Chatbot::Eliza style interface to Last.fm web services for an interactive (hopefully amusing) music recommendation bot.</p><p>Works surprisingly well - although only has one method at the moment..</p>

</article>

    
        <article class="post">
    <header>
      <h2><a href='http://theb0ardside.com/timetravellingwithunix/'> time travelling with Unix</a> </h2>
      <div class="post-meta">Sun, May 1, 2011</div>
    </header>
    <div><img class="aligncenter" title="SRI International " src="http://www.urigeller.com/wp-content/uploads/2015/01/uri_stanford_400_01.jpg" alt="" width="500" height="323" /></div><div><p>I discovered Unix back in 1998. At the time i was a lowly Windows desktop support engineer when i started dabbling with Red Hat Linux v 4.2. Compared to the process of fixing Windows 3.1 systems ( i.e. reinstall drivers and reboot - if that doesn&rsquo;t work, reinstall OS and drivers - repeat until it does work), playing with Linux was a joy of knowledge. Every part of the installation process was a problem hiding a wormhole of required knowledge. Eventually, we managed to start X - very literally, all we had was a grey screen with an &lsquo;X&rsquo; to represent the mouse pointer. However, it was addictive - every time you had to fix something, there was a reason for it, and you learned from that experience, and once fixed, it would stay fixed.</p><p>So, fast forward 13 years, and I find myself in a wiki loop, reading up on Bell Labs, then early iterations of Unix, and especially Version 7 Unix - <a href="http://en.wikipedia.org/wiki/Version_7_Unix">http://en.wikipedia.org/wiki/Version_7_Unix</a> - Back in 1998, i had my head full learning Linux and the newly released SunOS 5.7, so even though i was surrounded by older Vax, SGI, and Digital, I didn&rsquo;t explore much historical software at the time even though i did have a bit of a fixation with the PDP-11.</p></div>

<div><p>What caught my eye on the wiki page was this line - &ldquo;Bootable images for V7 can still be <a href="http://ftp.fibranet.cat/UnixArchive/PDP-11/Boot_Images/">downloaded</a> today, and can be run on modern hosts using PDP-11 emulators such as <a href="http://en.wikipedia.org/wiki/SIMH">SIMH</a>.&rdquo;.</p><p>whut??</p><p>Yeah! So, this is my step-by-step instructions for compiling SIMH on OS X (Snow Leopard 10.6.7), running the PDP-11 emulator and getting a V7 Unix image up and running on it. There are other HOWTOs out there and the documentation with SIMH does explain all this, but even so, I found it took me several hours of reading and searching to get things working, so I figure theres still room on the internets for what hopefully is a bit more of a concise howto..</p><p>You can find the SIMH homepage at:<br /><a href="http://simh.trailing-edge.com/">http://simh.trailing-edge.com/</a></p><p>The SIMH project consists of emulators for a bunch of historical machines, load of DEC machines from the VAX, through to the PDP range, plus IBMs, Honeywell, and even the Altair 8080.</p></div><div>&ldquo;<em>The Computer History Simulation Project is a loose Internet-based collective of people interested in restoring historically significant computer hardware and software systems by simulation. The goal of the project is to create highly portable system simulators and to publish them as freeware on the Internet, with freely available copies of significant or representative software.</em>&rdquo;</div><div><p>(You can also find a precompiled OS X binary at <a href="http://homepage.mac.com/mba/simh/index.html">http://homepage.mac.com/mba/simh/index.html</a> however compiling wasn&rsquo;t hard, and its all part of the fun, right?!)</p><p>First, if you don't already have it, you'll need to install Libpcap for network support, which you can get from <a href="http://www.tcpdump.org/">http://www.tcpdump.org/</a> - Install libpcap with the usual ./configure, make, make install dance, then download the simh source.</p><p>To install on OS X you need to export the OSTYPE environment variable.<br />(Or you'll get:<br />ld: library not found for -lrt<br />collect2: ld returned 1 exit status<br />make: *** [BIN/pdp1] Error 1)</p></div><div><strong>echo $OSTYPE</strong></div><div><strong> </strong><br /><strong>export OSTYPE</strong><br /><strong>make USE_NETWORK=1</strong></div><div><p>I encountered my first failure here, no BIN directory. Easily fixed with:</p><p><strong>mkdir BIN</strong><br /><strong>make USE_NETWORK=1</strong></p></div><div>boom!</div><div><strong>cd BIN</strong><br /><strong>./pdp11</strong>&nbsp;</p><p>After compiling, you can fire up any of the emulators and you&rsquo;ll find yourself in a <strong>sim&gt;</strong> shell.</p><p>&ldquo;Now what the hell do i do?&rdquo; was my first thought.</p><p>It took me a bit of reading to understand how to use the simulators, basically they are composed of the devices such as the CPU, disk, memory etc, plus Registers for which you set values. They are quite fully explained in - <a href="http://simh.trailing-edge.com/pdf/simh_doc.pdf">http://simh.trailing-edge.com/pdf/simh_doc.pdf</a> -</p><p>In order to load up any of the software, you have to set some device options, map your software image to a device then load it up. You&rsquo;ll find the software at:</p><p><a href="http://simh.trailing-edge.com/software.html">http://simh.trailing-edge.com/software.html</a></p><p>(and for more thorough explanation, read the doc at <a href="http://simh.trailing-edge.com/pdf/simh_swre.pdf">http://simh.trailing-edge.com/pdf/simh_swre.pdf</a>)</p><p>The correct V7 Unix to run on the PDP-11 is :<br /><a href="http://simh.trailing-edge.com/kits/uv7swre.zip"> http://simh.trailing-edge.com/kits/uv7swre.zip</a></p><p>The instructions given in the documentation are:</p><p><strong>sim&gt; set cpu u18 </strong><br /><strong> sim&gt; set rl0 RL02 </strong><br /><strong> sim&gt; att rl0 unix_v7_rl.dsk </strong><br /><strong> sim&gt; boot rl0 </strong><br /><strong>@boot </strong><br /><strong> New Boot, known devices are hp ht rk rl rp tm vt </strong><br /><strong> : rl(0,0)rl2unix </strong><br /><strong>#</strong></p><p>They are absolutely correct, however, a gotcha for me was that after i typed &ldquo;<strong>boot rl0</strong>&rdquo; I only got an &ldquo;<strong>@</strong>&rdquo; sign, and nothing more. I thought perhaps i had a corrupt image or something was different with my emulator. But no, i was just being a numpty, you actually need to type &ldquo;<strong>boot</strong>&rdquo; and press return, then type in the &#8220;<strong>rl(0,0)rl2unix </strong>&#8221; line too.</p><p>I also had to create a <strong>/tmp</strong> directory so i could view man pages, but yeah, apart from that, you should be good to go!</p><p>I also had fun playing with 2.11 BSD which i got from :<br /><a title="2.11" href="http://ftp.fibranet.cat/UnixArchive/PDP-11/Boot_Images/2.11_on_Simh/"> http://ftp.fibranet.cat/UnixArchive/PDP-11/Boot_Images/2.11_on_Simh/</a></p><p>This is a really well put together package, with a clear README file on how to use it.</p><p>download, unzip and run as:</p><p><strong>./pdp11 211bsd.simh</strong></p><p>You can even telnet into your virtual host:</p><p>rar!</p></div>

</article>

    
  </div>
</section>

      <script src="http://theb0ardside.com/static/js/jquery.js"></script>
      <script src="http://theb0ardside.com/static/js/bootstrap.min.js"></script>
      <script src="http://theb0ardside.com/static/js/mousetrap.min.js"></script>
      <script src="http://theb0ardside.com/static/js/b0ardside.js"></script>
      </div>
      </div>
      <div id="footer"></div>
  </body>

</html>

